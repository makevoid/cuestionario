!!!
%html
  %head
    %meta{ charset: :utf8 }
  %body
    %title Cuestionario
    %link{ href: "css/main.css", rel: "stylesheet" }
    :ruby
      alias :write  :haml_concat
      alias :tag    :haml_tag

      def input_text(label, options)
        tag :input
      end

      def textarea(label, options)
        tag :textarea, options
      end

      def select(label, choices, options)
        tag :select, options do
          choices.each do |choice|
            tag :option do
              write choice
            end
          end
        end
      end

      def input(label, options={}, options2={})
        tag :label do
          write label
          if options.is_a? Array
              select label, options, options2
          elsif options[:tag] == :area
            textarea label, options
          else
            input_text label, options
          end
        end
      end

      # import datas
      selects = eval(File.read "views/selects.rb")

      require 'json'

    %h1 Cuestionario para participantes en actividades URBAL


    %section
      %h1 1. Informaciones sobre usted (la persona que responde al cuestionario)
      - input "Nombre y apellido (opcional)"
      - input "Edad"
      - input "Sexo"
      - input "Lugar de residencia"
      - input "Municipio"
      - input "Provincia"
      - input "País"
      - input "Profesión"
      - input "Instrucción", %w(primaria secundaria universitaria)
      - input "Otra instrucción (especificar)"



    %section
      %h1 2. Información sobre el Proyecto URBAL III en el cual usted ha participado

      - input "a. Nombre del Proyecto", selects[:project_names], name: :project_name

      .partners
        - input "b. Socio del Proyecto con el cual usted ha participado", selects[:partners][0], name: :partners

      - input "c. Función al tiempo en el cual participó en el proyecto", selects[:functions]

      - input "d. Actividades en las cuales ha participado"
      (F> aparece listado de actividades desarrolladas por el proyecto)


    %script{ src: "js/underscore.js", type: "text/javascript" }
    %script{ src: "js/jquery.js", type: "text/javascript" }
    :javascript
      project_names = #{JSON.generate(selects[:project_names]).inspect}
      project_names = JSON.parse(project_names)
      partners = #{JSON.generate(selects[:partners]).inspect}
      partners = JSON.parse(partners)
      project_name = document.querySelector("[name=project_name]")
      partners_cont = document.querySelector(".partners")
      project_name.addEventListener("change", function(){
        partners_sel = document.querySelector("[name=partners]")
        partners_sel.remove()
        // partners_cont.appendChild()
        //
        project_name_idx = _(project_names).indexOf(project_name.value)
        options = ""
        _(partners[project_name_idx]).each(function(p, idx){
          options = options+"<option>"+p+"</option>"
        })
        select = "<select name='partners'>"+options+"</select>"
        $(partners_cont).append(select)

      })




    %section
      %h1 3a. Apreciación respecto a la cocepción del proyecto

      - input "Como considera usted que las actividades de (F> aparece actividad-es anteriormente seleccionada-s)  respondieron a las necesidades/prioridades de la población beneficaria del municipio/provincia donde se realizaron?", %w(mucho bastante poco nada)

      - input "Si possible podría indicar poqué usted considera qua las actividades del proyecto respondieron (F> aparece la opción escogida) a las necesidades/prioridades de la población beneficaria?", tag: :area

    %section
      %h1 3b. Apreciación respecto a la ejecución del proyecto

      - input "Considera usted que la organización para la realización de las actividades del proyecto (F> aparece nombre proyecto) fue?", ["bien planificada", "mejorable", "insuficiente", "inadecuada"]

      - input "Si possible podría indicar poqué usted considera qua la organizacion del proyecto fue (F> aparece la opción escogida)"

      - input "Considera usted que los medios puestos a disposición para la realización de las actividades del proyecto (F> aparece nombre proyecto) fueron?", ["abundantes", "adecuados", "insuficientes", "muy escasos"]

      - input "Si possible podría indicar poqué usted considera que los medios puestos a disposición fueron (F> aparece la opción escogida)", tag: :area


    %section
      %h1 4. Apreciación respecto a los efectos del proyecto

      - input "Como considera usted que las actividades de (F> aparece actividad-es anteriormente seleccionada-s)  en la cuales usted ha participado contribuyenron al logro del Objetivo Especifico del Proyecto (F> aparece nombre del proyecto) que era de (F> aparece enunciación del objetivo)?", %w(alto parcial poco nada)

      - input "Si possible podría indicar poqué usted considera que el nivel de contribución al Objetivo especifico fué (F> aparece la opción escogida)", tag: :area


    %section
      %h1 5. Apreciación respecto a la durabilidad de los efectos del proyecto

      - input "Considera usted que los efectos esperados de (F> aparece enunciación del objetivo) se están manteniendo también en la actualidad, o se ha perdido depsués de la finalización del Proyecto (F> aparece nombre proyecto)?", ["persisten totalmente", "persisten parcialmente", "se han perdido en mayoría", "se han perdido totalmente"]

      - input "Si possible podría indicar poqué usted considera que los efectos del Proyecto (F> aparece la opción escogida)", tag: :area


